# -----------------------------------------------------------------------------
# ğŸ“¦ GitHub Actions: docker-ci.yml
# Purpose: Automatically build and publish Docker images 
# on every push to the `main` branch.
# This is a CI/CD workflow (Continuous Integration & Delivery).
#
# What it does:
# 1. Clones the project code.
# 2. Logs into Docker Hub.
# 3. Builds backend and frontend Docker images.
# 4. Pushes these images to Docker Hub.
# -----------------------------------------------------------------------------

name: Docker CI  # Workflow name shown on GitHub

on:
  push:
    branches: [ main ]  # ğŸ‘‰ Run only when pushing to the "main" branch

jobs:
  build:  # ğŸ‘· Job name
    runs-on: ubuntu-latest  # ğŸ”§ GitHub Actions will run on an Ubuntu VM

    steps:  # ğŸ“‹ Steps executed sequentially

      - name: Checkout code  # ğŸ§¾ Step 1: Clone the repository
        uses: actions/checkout@v3  # ğŸ“¥ Official GitHub checkout action

      - name: Set up Docker Buildx  # ğŸ§° Step 2: Setup Buildx â€” Docker extension for advanced builds
        uses: docker/setup-buildx-action@v3  # ğŸ“¦ Action to install buildx

      - name: Login to Docker Hub  # ğŸ” Step 3: Authenticate to Docker Hub to push images
        uses: docker/login-action@v3  # ğŸ›‚ Official login method
        with:
          username: ${{ secrets.DOCKER_USERNAME }}  # ğŸ”’ Username from GitHub secrets
          password: ${{ secrets.DOCKER_PASSWORD }}  # ğŸ”’ Password or token from secrets (secure)

      - name: Build and push backend  # âš™ï¸ Step 4: Build and push backend image
        uses: docker/build-push-action@v5  # ğŸ› ï¸ Build and push Docker images
        with:
          context: ./backend  # ğŸ“ Build context â€” backend folder
          tags: ${{ secrets.DOCKER_USERNAME }}/flask-api:latest  # ğŸ·ï¸ Image name: dockerhub_user/flask-api
          push: true  # ğŸ“¤ Push the image after build

      - name: Build and push frontend  # âš™ï¸ Step 5: Build and push frontend image
        uses: docker/build-push-action@v5  # ğŸ› ï¸ Same as above, for frontend
        with:
          context: ./frontend  # ğŸ“ Build context â€” frontend folder
          tags: ${{ secrets.DOCKER_USERNAME }}/node-frontend:latest  # ğŸ·ï¸ Image name: dockerhub_user/node-frontend
          push: true  # ğŸ“¤ Push the image to Docker Hub

      - name: Build and push nginx  # âš™ï¸ Step 6: Build and push nginx image
        uses: docker/build-push-action@v5  # ğŸ› ï¸ Same, for nginx
        with:
          context: ./nginx  # ğŸ“ Build context â€” nginx folder
          tags: ${{ secrets.DOCKER_USERNAME }}/nginx:latest  # ğŸ·ï¸ Image name: dockerhub_user/nginx
          push: true  # ğŸ“¤ Push the image to Docker Hub
